version: 0.0
os: linux

# https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-resources.html#reference-appspec-file-structure-resources-ecs
Resources:
  - TargetService:
      Type: AWS::ECS::Service
      Properties:
        TaskDefinition: "[Your task definition arn]"
        LoadBalancerInfo:
          ContainerName: "[Your container Name]"
          ContainerPort: 8000
#        PlatformVersion: "[Version number, ex: 1.3.0]"
#        NetworkConfiguration:
#          AwsvpcConfiguration:
#            Subnets: ["SubnetId1","SubnetId2"]
#            SecurityGroups: ["ecs-security-group-1"]
#            AssignPublicIp: "ENABLED-or-DISABLED"
# https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html#appspec-hooks-ecs
#Hooks:
files:
  - source: /node-backend
    destination: /var/www/receipts
hooks:
  BeforeInstall:
    - location: deploy_scripts/before_install.sh
      timeout: 300
      runas: root
  AfterInstall:
    - location: deploy_scripts/after_install.sh
      timeout: 300
      runas: root
  ApplicationStart:
    - location: deploy_scripts/start_server.sh
      timeout: 300
      runas: root
  ApplicationStop:
    - location: deploy_scripts/stop_server.sh
      timeout: 300
      runas: root
